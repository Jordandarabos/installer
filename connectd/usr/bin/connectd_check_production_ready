#!/bin/sh 
#
#  remote.it Check Production Readiness Script allows developers to know if the deviceis cloneable
#    and will help reset a device to make it ready for production
#
#  NOTE: This is a development script and not used in a production device
#
#  connectd_check_production_ready  
#
#  will alter contents in CONNECTD_DIR
#
#  remot3.it, Inc. : https://remote.it

BASEDIR=
CONNECTD_DIR="$BASEDIR"/etc/connectd
# pick up global options, e.g. PLATFORM and API
. "$CONNECTD_DIR"/oem_settings

# test for unique identifiers - status will emit on errors
echo "CPU ID:"$(oemGetSystemId)
echo "Hardware ID:"$(oemGetDefaultHardwareId)
echo "Registration Key:"$(oemGetDefaultRegistrationKey)

DIRECTORY=/etc/connectd/services
if [ -d "$DIRECTORY" ]; then
    echo "Issue: remote.it services folder exists"
    STATUS=0
fi

DIRECTORY=/etc/connectd/pfiles
if [ -d "$DIRECTORY" ]; then
    echo "Issue: remote.it provisioning folder exists"
    STATUS=0
fi

DIRECTORY=/etc/connectd/dfiles
if [ -d "$DIRECTORY" ]; then
    echo "Issue: remote.it configuration folder exists"
    STATUS=0
fi

DIRECTORY=/etc/connectd/active
if [ -d "$DIRECTORY" ]; then
    echo "Issue: remote.it active service folder exists"
    STATUS=0
fi

DIRECTORY=/etc/connectd/available
if [ -d "$DIRECTORY" ]; then
    echo "Issue: remote.it available service folder exist"
    STATUS=0
fi

if [ -f "/etc/connectd/bulk_identification_code.txt" ]; then
    bic=$(cat /etc/connectd/bulk_identification_code.txt)
else
   echo "Issue: Bulk Identification Code missing"
   STATUS=0
fi

if [ -z "$STATUS" ] ; then
    echo "Ok:  device is cloneable for production"
else
    echo "Issue: No device is not safe to clone for production." 
    echo "ACTION: Use the sudo connectd_prepare_production command to ready this system" 
fi

